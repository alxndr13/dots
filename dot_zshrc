# zsh compsys
autoload -Uz compinit
day_of_year=$(stat -c %Y $HOME/.zcompdump | xargs -I {} date -d @{} +%j)
if [ $(date +'%j') != $day_of_year ]; then
  compinit
else
  compinit -C
fi

source '/usr/share/zsh-antidote/antidote.zsh'

antidote load

export PATH=$PATH:/home/ahuck/go/bin
export PATH="${KREW_ROOT:-$HOME/.krew}/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"

# History Settings
HISTFILE=$HOME/.zsh_history
HISTSIZE=500000
SAVEHIST=500000
setopt appendhistory
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY

unsetopt flow_control
setopt autocd


export EDITOR="nvim"
alias ll='eza --icons -l --time-style relative --git -snew '
alias k='kubectl'
# source <(kubectl completion zsh)
# compdef kubecolor=kubectl
alias calsync="~/calendarsync.sh"
alias standup='git-standup -d 1 -s'
alias kx='kubectx'
alias kns='kubens'
alias cat='bat -pp'
alias pat='bat --paging=always'
alias note='vim ~/notes.txt'
alias td="todo.sh"
alias pass='gopass'
alias vi='nvim'
alias dp='describepod'
alias fp='findpod'
alias tp='tailpod'
alias vim='nvim'
alias sudo='sudo '
alias opsshuffle='echo "Alex\nDonato\nHekmat\nJoe\nLukas\nSimon" | shuf -n 2'
alias watch='watch '
alias gitdeleteorphan="git fetch -p ; git branch -r | awk '{print \$1}' | grep -E -v -f /dev/fd/0 <(git branch -vv | grep origin) | awk '{print \$1}' | xargs git branch -D"
alias gittrackallremote="for branch in \$(git branch -r | awk \"{print \$1}\" | grep origin | grep -Ev \"(HEAD|main)\" | cut -d\/ -f2-); do git branch --track \$branch origin/\$branch || true ; done"
alias cze='chezmoi edit --apply'
alias dnsflush='systemd-resolve --flush-caches'
alias pd='podman'
alias htop='btm'
alias top='btm'
alias tf='terraform'
alias tfi='terraform init'
alias tfs='terraform state'
alias tfsl='terraform state list'
alias tfss='terraform state show'
alias tfmt='terraform fmt'
alias tfp='terraform plan'
alias tfa='terraform apply'
alias tfaa='terraform apply --auto-approve'
alias lz='lazygit'
alias bton='bluetoothctl power on'
alias btoff='bluetoothctl power off'
alias btbose='bluetoothctl connect 60:AB:D2:41:CD:11'
alias btbosedisc='bluetoothctl disconnect 60:AB:D2:41:CD:11'
alias btk6='bluetoothctl connect DC:2C:26:2A:3E:00'
alias btmx='bluetoothctl connect DA:E8:97:89:F2:96'
alias maxuhrzeit="TZ='Pacific/Honolulu' date --rfc-email"
alias n='nnn'
alias st='stern'
alias kt='kitty --detach'
alias k9s='k9s --logoless -A'
alias kill9='kill -9'
alias gomobile='~/.local/bin/switch-headset-mode.sh headset-head-unit-msbc && nmcli radio wifi on'
alias asciicast2gif='docker run --rm -v $PWD:/data asciinema/asciicast2gif'
#alias kapitan='docker run -t --rm -v $(pwd):/src:delegated docker.markant.com/mips-ql-infra/infra-base/infra-base:stable kapitan'
alias cal='cal -w -n 3 -m'
alias cz='chezmoi'
alias vimdiff='nvim -d'
alias d="cd /home/ahuck/Dokumente/nvim_zettelkasten/ && nvim /home/ahuck/Dokumente/nvim_zettelkasten/$(date "+%Y-%m-%d").md; cd -"
alias m="cd /home/ahuck/Dokumente/nvim_zettelkasten/ && nvim /home/ahuck/Dokumente/nvim_zettelkasten/$(date --date=tomorrow "+%Y-%m-%d").md; cd -"
alias dive="dive --source=podman"
alias valevocab="chezmoi edit --apply .config/vale/styles/Vocab/MyVocab/accept.txt"
alias wlc='wl-copy'
alias cronlogs='journalctl -b 0 -f -n 10000 | rg -i cron'

until_success() {
  until zsh -c "$@"; do sleep 0.5; done
}

until_forever() {
  until false; do zsh -c "$@"; sleep 0.5; done
}

# Markhub AKS Proxy

# alias markhub-aks-proxy="source /home/ahuck/Code/markant/cs/infrastructure/deploy/*/scripts/aks-ssh-port-forwarding.sh"

# Markant check elevation
func checkinfrapim () {
  az ad user get-member-groups --id admhucka@de.markant.com | jq '.[] | select(.displayName == "az-rbac-pag-cloudinfra")' && if [[ $? -eq 0 ]]; then echo "user is part of az-rbac-pag-cloudinfra"; fi
}

alias tflint_odm='tflint --enable-rule terraform_deprecated_index --enable-rule terraform_unused_declarations --enable-rule terraform_comment_syntax --enable-rule terraform_documented_outputs --enable-rule terraform_documented_variables --enable-rule terraform_typed_variables --enable-rule terraform_naming_convention --disable-rule terraform_module_pinned_source --disable-rule aws_acm_certificate_invalid_private_key --enable-rule terraform_required_version --enable-rule terraform_required_providers --enable-rule terraform_standard_module_structure --enable-rule terraform_workspace_remote'


# [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
__git_files () {
    _wanted files expl 'local files' _files
}

function kdebug() {
  kubectl run test-pod-hucka-$RANDOM -n monitoring -ti --image docker.mirror.markant.com/alpine:latest --restart=Never --rm -- sh
}

function countnodes() {
  kubectl get nodes | tail -n +2 | wc -l
}

function =
{
  echo "$@" | bc -l
}

# Load Bash Completion files in zsh
# autoload -U +X bashcompinit && bashcompinit

# Shift Tab to accept autosuggestion
bindkey '^[[Z' autosuggest-accept
# CTRL+ arrow keys for word
bindkey "^[[1;5C" forward-word
bindkey "^[[1;5D" backward-word
bindkey "^[." insert-last-word

_evalcache starship init zsh

## direnv
_evalcache direnv hook zsh
## zoxide
_evalcache zoxide init zsh

# export MCFLY_FUZZY=2
# export MCFLY_RESULTS=20
# export MCFLY_INTERFACE_VIEW=BOTTOM
# export MCFLY_PROMPT="❯"
# export MCFLY_KEY_SCHEME=vim
# _evalcache mcfly init zsh

